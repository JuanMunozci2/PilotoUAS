<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quiz Piloto UAS</title>
  <style>
    :root{font-family:Arial,Helvetica,sans-serif;background:#111;color:#f5f5f5;}
    #app{max-width:720px;margin:40px auto;padding:24px;border:2px solid #444;border-radius:14px;background:#222;box-shadow:0 0 25px rgba(0,0,0,.6);}
    h1{text-align:center;margin-bottom:14px;font-size:1.8rem;letter-spacing:.4px;}
    select{width:100%;padding:10px;border-radius:8px;margin-bottom:20px;background:#333;color:#f5f5f5;border:none;font-size:1rem;cursor:pointer;}
    .category{font-size:1.1rem;font-weight:600;margin-bottom:6px;color:#00e5ff;text-align:center;}
    button{display:block;width:100%;margin:9px 0;padding:13px;border:none;border-radius:9px;font-size:1rem;cursor:pointer;background:#333;color:#f5f5f5;transition:background .2s;}
    button:hover{background:#555;}
    button.correct{background:#2e7d32!important;color:#fff;}
    button.wrong{background:#c62828!important;color:#fff;}
    #status{margin-top:18px;text-align:center;font-size:1.1rem;min-height:1.4em;}
    #next-btn{margin-top:22px;background:#0069c0;display:none;}
    .progress-bar{height:12px;background:#444;border-radius:4px;overflow:hidden;margin-bottom:24px;}
    .progress-bar-inner{height:100%;width:0;background:#00c853;transition:width .4s;}
  </style>
</head>
<body>
  <div id="app">
    <h1>Quiz Piloto UAS</h1>
    <select id="category-select">
      <option value="all">Todas las categorías (413)</option>
      <option value="rac100">RAC 100 (95)</option>
      <option value="derecho">Derecho Aéreo y Regulaciones (41)</option>
      <option value="aerodinamica">Aerodinámica Aplicada (32)</option>
      <option value="meteorologia">Meteorología Aeronáutica (56)</option>
      <option value="navegacion">Navegación Aérea (54)</option>
      <option value="comunicaciones">Comunicaciones Aeronáuticas (14)</option>
      <option value="factoreshumanos">Factores Humanos y Actuación Humana (17)</option>
      <option value="seguridad">Gestión de la Seguridad Operacional (48)</option>
      <option value="ua">Conocimientos Generales de las UA (35)</option>
      <option value="planificacion">Planificación de Vuelo (21)</option>
    </select>

    <div class="progress-bar"><div class="progress-bar-inner" id="bar"></div></div>
    <div id="category" class="category"></div>
    <div id="question"></div>
    <div id="options"></div>
    <div id="status"></div>
    <button id="next-btn">Siguiente</button>
  </div>

  <script>
  const files={
    all:'uas-bank.json',
    rac100:'rac100.json',
    derecho:'derecho.json',
    aerodinamica:'aerodinamica.json',
    meteorologia:'meteorologia.json',
    navegacion:'navegacion.json',
    comunicaciones:'comunicaciones.json',
    factoreshumanos:'factoreshumanos.json',
    seguridad:'seguridad.json',
    ua:'ua.json',
    planificacion:'planificacion.json'
  };

  let questions=[];let current=0,score=0;
  const catEl=document.getElementById('category');
  const qEl=document.getElementById('question');
  const optEl=document.getElementById('options');
  const statusEl=document.getElementById('status');
  const nextBtn=document.getElementById('next-btn');
  const bar=document.getElementById('bar');
  const select=document.getElementById('category-select');

  select.addEventListener('change',()=>loadCategory(select.value));

  function loadCategory(key){
    fetch(files[key]).then(r=>r.json()).then(data=>{
      questions=data;
      shuffleArray(questions);
      current=0;score=0;
      bar.style.width='0%';
      loadQuestion();
    }).catch(err=>{
      qEl.textContent='No se pudo cargar '+files[key];
      console.error(err);
    });
  }

  function loadQuestion(){
    const q=questions[current];
    catEl.textContent=q.category || 'General';
    qEl.textContent=`${current+1}. ${q.q}`;
    optEl.innerHTML='';
    q.options.forEach((opt,i)=>{
      const btn=document.createElement('button');
      btn.textContent=opt;
      btn.addEventListener('click',()=>selectOption(btn,i));
      optEl.appendChild(btn);
    });
    statusEl.textContent='';
    nextBtn.style.display='none';
  }

  function selectOption(clickedBtn,idx){
    const q=questions[current];
    Array.from(optEl.children).forEach((btn,i)=>{
      btn.disabled=true;
      if(i===q.correct){btn.classList.add('correct');}
    });
    if(idx!==q.correct){
      clickedBtn.classList.add('wrong');
      statusEl.textContent=`Incorrecto. Respuesta correcta: ${q.options[q.correct]}`;
    }else{
      score++;statusEl.textContent='¡Correcto!';
    }
    bar.style.width=`${(score/questions.length)*100}%`;
    nextBtn.style.display='block';
  }

  nextBtn.addEventListener('click',()=>{
    if(current<questions.length-1){current++;loadQuestion();}
    else{qEl.textContent='¡Juego terminado!';catEl.textContent='';optEl.innerHTML='';nextBtn.style.display='none';statusEl.textContent=`Aciertos: ${score}/${questions.length}`;confetti();}
  });

  function shuffleArray(arr){
    for(let i=arr.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[arr[i],arr[j]]=[arr[j],arr[i]];}
  }

  function confetti(){const d=2000,end=Date.now()+d;(function frame(){confettiBurst();if(Date.now()<end)requestAnimationFrame(frame);})();}
  function confettiBurst(){for(let i=0;i<18;i++){const el=document.createElement('div');el.style.position='fixed';el.style.zIndex=9999;el.style.top=Math.random()*100+'vh';el.style.left=Math.random()*100+'vw';el.style.width=el.style.height='8px';el.style.background=`hsl(${Math.random()*360},100%,50%)`;el.style.pointerEvents='none';el.style.opacity=1;document.body.appendChild(el);const anim=setInterval(()=>{el.style.transform=`translateY(${parseFloat(el.style.top)+Math.random()*4}px)`;el.style.opacity-=0.02;if(el.style.opacity<=0){clearInterval(anim);el.remove();}},16);}}

  // Carga inicial
  loadCategory('all');
  </script>
</body>
</html>
